version: "1"
default:
  env-file: .env
  repository: "{{ .Env.RESTIC_REPOSITORY }}"
  password-file: "password.txt"
  force-inactive-lock: true
  lock: $HOME/.tmp/ds224/restic-dikei.lock
  status-file: $HOME/.tmp/ds224/restic-backup-status.json
  backup:
    verbose: true
    source-base: "$HOME"
    group-by: "tags"
    tag:
      - linux-station
    exclude-caches: true
    exclude-file: excludes.txt
    run-before:
      - notify-send -t 5000 "Start backing up to ds224"
      - logger "Start backing up to ds224"
    run-after:
      - notify-send -t 5000 "Backup to ds224 complete"
      - logger "Backup to ds224 complete"
    run-after-fail:
      - notify-send -t 5000 "Backup to ds224 failed with error ${ERROR_EXIT_CODE}"
      - logger -p user.error "Backup to ds224 failed with error ${ERROR_EXIT_CODE}"
    schedule: "*:15" # Every hour in minutes 15
    schedule-permission: user
    schedule-priority: background
    schedule-log: $HOME/.tmp/restic-scheduler.log
    schedule-lock-mode: default
    schedule-lock-wait: 15m
  retention:
    group-by: "tags"
    before-backup: false
    after-backup: true
    prune: true
    keep-last: 168
    keep-hourly: 2160
    keep-daily: 365
    keep-weekly: 105
    keep-monthly: 60
    keep-yearly: 10
  check:
    read-data: true
    # check the repository the first day of each month at 3am, or the next time the machine turn on
    schedule: "*-*-01 08:00:00"
    schedule-permission: user
    schedule-priority: background
    schedule-log: $HOME/.tmp/ds224/restic-scheduler.log
    schedule-lock-mode: default
    schedule-lock-wait: 15m
